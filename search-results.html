<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Yelp Home-Page</title>
    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="styles.css" rel="stylesheet" />
    <link href="bootstrap/css/style.css?a1" rel="stylesheet" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="scripts/jquery.placeholder.min.js" type="text/javascript"></script>
    <script src="scripts/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
    <script src="js/tag-filter.js"></script>
    <script src="js/fs-wrapper.js"></script>
    <script src="js/yelp-wrapper.js"></script>
    <script src="js/mustache.js"></script>
    <script src="js/jquery_1.8.2.min.js"></script>
    <script src="js/tag_assignment.js"></script>
    <script id="result_template" type="text/template">
      {{#.}}
        <div id="{{o.id}}" class="well well-small clearfix result">
          <div class="span2">
            <img class="thumbnail" src="{{o.image_url}}">
          </div>
          <div class="span4 pull-left">
            <a href="{{o.url}}">
              <h4 class="yelp-red">{{o.name}}</h4>
            </a> 
            <p><b> Neighborhoods: </b>{{o.neighborhoods}}</p>
            <p class="categories"><b> Categories: </b>
              {{#o.categories}}
                {{.[0]}}
              {{/o.categories}}
            </p>
          </div>
          <div class="middle span3 pull-left">
            <img src="{{o.rating_img_url}}"> {{o.review_count}} reviews 
            <address>{{o.display_phone}}<br>{{o.location.address}}<br>{{o.location.city}}, {{o.location.state_code}}</address>
          </div>
          <div class="span2 pull-right">
            <button class="pull-right btn btn-large btn-success" onclick="return startTagIt(activeResults,{{idx}});"> Tag It! </button>

            {{#tags}}
              <span id="{{.}}" class="tag">{{.}}</span>
            {{/tags}}
          </div>
        </div>
      {{/.}}
    </script>
    <script type="text/javascript">
      function hideHero() {
        $(".hero-unit").hide();
        $("#results").empty();
      }
      
          function processTags(e, id) {
              var $e = $(e);
              jQuery.each($e, function(i, val){
                  $("#" + id + " div.biz-tags").append('<span id="' + val + '" class="tag pull-left">' + val + ' </span>');
              });
          }

          function processCategories(e, id) {
              var $e = $(e);
              jQuery.each($e, function(i, val){
                  $("#" + id + " p.categories").append(val[0] + ", ");
              });
          }

      function showMessageBadQuery(){
        document.getElementById('bad-input').style.display = 'block';
         document.getElementById('searching').style.display = 'none';
      }
      function showMessageNoResultsQuery(){
        //document.getElementById('no-results').style.display = 'block';
        document.getElementById('searching').style.display = 'none';
      }


      var activeResults;
      function searchResults(numberofresults) {

          document.getElementById('bad-input').style.display = 'none';
          document.getElementById('no-results').style.display = 'none';
          document.getElementById('numberofresults').style.display = 'none';
          document.getElementById('showtotalresults').style.display = 'none';
          document.getElementById('searching').style.display = 'block';
         
          hideHero();
          var $query = document.getElementById('query').value;
          var $zip = document.getElementById('zip').value;
          var directtopage = numberofresults * 20;
          
          if($query=="" || $zip==""){
            showMessageBadQuery();
          } else {
              
            var fun = function(data){
                
              console.log(data);
              $("#results").empty();
              $("#numberofresults").empty();
              $("#totalresults").empty();
              
              activeResults = data.businesses;

              var $numResults = data.total;
              var $numberOfPageResults = data.total / 20;
                
              if($numResults == 0){
                  showMessageNoResultsQuery();
              } else {
                $('#numberofresults').append('<p>Success: There are ' + $numResults + ' results</p>');
                document.getElementById('numberofresults').style.display = 'block';
               
               
                if($numResults > 19){
                  for(j=0; j < $numberOfPageResults -1 ; j++ ){
                      $('#totalresults').append('<option value="' + j + '">' + j + '</option>'); 
                  }

                  document.getElementById('showtotalresults').style.display = 'block';
                }
                document.getElementById('searching').style.display = 'none';

                var objects = [];

                var buildTags = function(results, objects, cb, idx) {
                  if(!objects.length) {
                    cb(results);
                  } else {
                    getTagsForId(objects[0].id, function(tags) {
                      results.push({"idx": idx, "o": objects[0], "tags": tags});

                      buildTags(results, objects.splice(1), cb, idx + 1);
                    });
                  }
                }

                buildTags([], data.businesses, function(objects) {
                  var template = $('#result_template').html();
                  var html = Mustache.to_html(template, objects);
                  $('#results').html(html);
                }, 0);

              }
            }
            searchAndDo($("#query").val(), $("#zip").val(), directtopage , fun );             
          }

        return false;
      }

      $(document).ready( function (){ 
        $.getJSON('data_wrapper.json', function(data) {

        }); 
      });

    </script> 
   
  </head>
   <body>
    <div id="body-wrapper">
      <div class="container">
        <!-- Navbar and Search Bar -->
        <div>
          <ul class="nav nav-tabs">
        	  <li class="active">
        	    <a href="search-results.html">Home</a>
        	  </li>
        	  <li>
              <a href="yourtags.html">Your Tags</a>
            </li>
            <li>
              <!-- Search Bar -->
              <div id="search-bar">

              <form class="form-search search-bar" onsubmit="return searchResults(0);">
                  <input type="text" id="query" class="input-large span6 search-query" placeholder="search for (e.g. Mexican, Joe's Pizza, cheap)">
                  <input type="text" id="zip" class="input-large span2 search-query" placeholder="Location">
                  <button type="button" class="btn btn-primary" onclick="return searchResults(0);">Search for places</button>
              </form>
              </div>
            </li>
          </ul>   
        </div>
     
        <!-- Hero Unit -->
        <div class="hero-unit dl-horizontal clearfix" style="display: inline;">
          <img src="bootstrap/img/yelp logo.png" class="img-small pull-right">
          <h1 class="pull-up">Yelp</h1>
          <div class="pull-down">Yelp is the best way to find great local business</div>
        </div>
       
        <div id="searching" class = "well form-horizontal hide alert alert-info">
        Searching...
        </div>
        <div id="numberofresults" class = "well form-horizontal hide alert alert-success">
        </div>
        <div class = "well form-horizontal hide alert alert-error" id="bad-input">
        <p>This input is invalid. Please enter a valid Search and Location .</p>
        </div>
        <div class = "well form-horizontal hide alert alert-block" id="no-results">
        <p>The search returned zero results. Please check if you have made a typo anywhere</p>
        </div>
       
        <!-- Search Results -->
        <div id="results"></div>

        <div id="showtotalresults" class="well-small hide form-horizontal pull-right">
          <b>Results per page  <select style="width:50px" id="totalresults" class = "form-horizontal" onChange="searchResults(this.value)">  </select></b>
         
        </div>
      </div>
    </div> 

    <div id="tagit" style="display:none;">
      <div class="tag-assignment-wrapper">
        <h2>Choose tags for <span id="business-name" class="yelp-red"> Joe's Pizza </span></h2>
        <div id="chosen-tags" class="tag-container">

        </div>
        <h2>Existing Tags</h2>
        <div id="existing-tags" class="tag-container">
        </div>

        <h2>Recommended Tags</h2>
        <div id="recommended-tags" class="tag-container">

        </div>

        <h2>Add New Tag</h2>
        <form onsubmit="return createTag()">
          <input id="new-tag" type="text" style="width: 300px;font-size:18px;"/> 
          <button type="submit" class="button" onclick="return createTag()">Add</button>
        </form>

        <div style="clear: both;"></div>
        <div style="text-align:right;padding: 30px;">
          <a href="#" class="button" onclick="return submitTags();">Submit</a>
        </div>
      </div>
    </div>
    <div id="screen" style="display:none;">&nbsp;</div>
  </body>
</html>