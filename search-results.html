<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Yelp Home-Page</title>
    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="styles.css" rel="stylesheet" />
    <link href="bootstrap/css/style.css?a1" rel="stylesheet" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="scripts/jquery.placeholder.min.js" type="text/javascript"></script>
    <script src="scripts/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>

    <script src="js/tag-filter.js"></script>
    <script src="js/fs-wrapper.js"></script>
    <script src="js/yelp-wrapper.js"></script>
    <script src="js/mustache.js"></script>
    <script src="js/jquery_1.8.2.min.js"></script>
    <script type="text/javascript">
      function hideHero() {
        $(".hero-unit").hide();
        $("#results").empty();
      }
      
          function processTags(e, id) {
              var $e = $(e);
              jQuery.each($e, function(i, val){
                  $("#" + id + " div.biz-tags").append('<span id="' + val + '" class="tag pull-left">' + val + ' </span>');
              });
          }

          function processCategories(e, id) {
              var $e = $(e);
              jQuery.each($e, function(i, val){
                  $("#" + id + " p.categories").append(val[0] + ", ");
              });
          }

      function showMessageBadQuery(){
        document.getElementById('bad-input').style.display = 'block';
         document.getElementById('searching').style.display = 'none';
      }
      function showMessageNoResultsQuery(){
        //document.getElementById('no-results').style.display = 'block';
        document.getElementById('searching').style.display = 'none';
      }

      function searchResults(numberofresults) {

          document.getElementById('bad-input').style.display = 'none';
          document.getElementById('no-results').style.display = 'none';
          document.getElementById('numberofresults').style.display = 'none';
          document.getElementById('showtotalresults').style.display = 'none';
          document.getElementById('searching').style.display = 'block';
         
          hideHero();
          var $query = document.getElementById('query').value;
          var $zip = document.getElementById('zip').value;
          var directtopage = numberofresults * 20;
          
          if($query=="" || $zip==""){
            showMessageBadQuery();
          }

          else{
              
              var fun = function(data){
                
                console.log(data);
                $("#results").empty();
                $("#numberofresults").empty();
                $("#totalresults").empty();
                
                var $numResults = data.total;
                var $numberOfPageResults = data.total / 20;
                
               if($numResults == 0){
                  showMessageNoResultsQuery();
               }
               else{
                  $('#numberofresults').append('<p>Success: There are ' + $numResults + ' results</p>');
                  document.getElementById('numberofresults').style.display = 'block';
                 
                 
                  if($numResults > 19){
                    for(j=0; j < $numberOfPageResults -1 ; j++ ){
                        $('#totalresults').append('<option value="' + j + '">' + j + '</option>'); 
                    }

                    document.getElementById('showtotalresults').style.display = 'block';
                  }
                  document.getElementById('searching').style.display = 'none';

                  for (i = 0; i < $numResults; i++) {
                      var $id = data.businesses[i].id;
                      var $name = data.businesses[i].name;
                      var $categories = data.businesses[i].categories;
                      var $display_phone = data.businesses[i].display_phone;
                      var $image_url = data.businesses[i].image_url;
                      var $address = data.businesses[i].location.address;
                      var $city = data.businesses[i].location.city;
                      var state = data.businesses[i].location.state_code;
                      var $neighborhoods = data.businesses[i].location.neighborhoods;
                      if(typeof($neighborhoods) == 'undefined') $neighborhoods = '';
                      var $rating_img_url = data.businesses[i].rating_img_url;
                      var $review_count = data.businesses[i].review_count;
                      var $url = data.businesses[i].url;
                      var $tags = data.businesses[i].tags;
                      
                      $('#results').append('<div id ="' + $id + '"class="well well-small clearfix result"><div class="span2"><img class="thumbnail" src="' + $image_url + '"></div><div class="span4 pull-left"><a href="' + $url + '"><h4 class="yelp-red">' + $name + '</h4></a> <p><b> Neighborhoods: </b>' + $neighborhoods + '</p><p class="categories"><b> Categories: </b></div><div class="middle span3 pull-left"> <img src="' + $rating_img_url + '"> ' + $review_count + ' reviews <address>' + $display_phone + '<br>' + $address + '<br>' + $city + ', ' + state + '</address></div><div class="span2 pull-right"><button class="pull-right btn btn-large btn-success"> Tag It! </button></div></div>');

                     processTags($tags, $id);
                     processCategories($categories, $id);
                  }
                }
              }
          searchAndDo($("#query").val(), $("#zip").val(), directtopage , fun );             
        }
          
      }

      
    </script> 
   
  </head>
   <body>
    <div id="body-wrapper">
      <div class="container">
        <!-- Navbar and Search Bar -->
        <div>
          <ul class="nav nav-tabs">
        	  <li class="active">
        	    <a href="search-results.html">Home</a>
        	  </li>
        	  <li>
              <a href="yourtags.html">Your Tags</a>
            </li>
            <li>
              <!-- Search Bar -->
              <div id="search-bar">
  <!--              <form class="form-search search-bar"> -->
                  <input type="text" id="query" class="input-large span6 search-query" placeholder="search for (e.g. Mexican, Joe's Pizza, cheap)">
                  <input type="text" id="zip" class="input-large span2 search-query" placeholder="Location">
                  <button type="button" class="btn btn-primary" onclick="searchResults(0)">Search for places</button>
  <!--              </form>
                <button type="button" class="btn btn-primary pull-right" style="margin-left: 10px;" onclick="searchResults()">Search for places</button> -->
              </div>
            </li>
          </ul>   
        </div>
     
        <!-- Hero Unit -->
        <div class="hero-unit dl-horizontal clearfix" style="display: inline;">
          <img src="bootstrap/img/yelp logo.png" class="img-small pull-right">
          <h1 class="pull-up">Yelp</h1>
          <div class="pull-down">Yelp is the best way to find great local business</div>
        </div>
       
        <div id="searching" class = "well form-horizontal hide alert alert-info">
        Searching...
        </div>
        <div id="numberofresults" class = "well form-horizontal hide alert alert-success">
        </div>
        <div class = "well form-horizontal hide alert alert-error" id="bad-input">
        <p>This input is invalid. Please enter a valid Search and Location .</p>
        </div>
        <div class = "well form-horizontal hide alert alert-block" id="no-results">
        <p>The search returned zero results. Please check if you have made a typo anywhere</p>
        </div>
       
        <!-- Search Results -->
        <div id="results">
          </div>
         <div id="showtotalresults" class="well-small hide form-horizontal pull-right">
          <b>Results per page  <select style="width:50px" id="totalresults" class = "form-horizontal" onChange="searchResults(this.value)">  </select></b>
         
        </div>
      </div>
    </div> 
  </body>
</html>